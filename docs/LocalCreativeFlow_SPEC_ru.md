# Local Creative Flow — проектный mindmap

## Назначение
Local Creative Flow помогает продюсерам и креативным командам спланировать проект как mindmap. Утилита не пытается полностью автоматизировать продакшн, а фиксирует узлы, связи и промежуточные артефакты (тексты, медиа, файлы). Каждая нода показывает, что нужно подготовить, что уже сделано и какие входы требуются следующему шагу.

## Основные сущности
- **Текстовые и файловые ноды.** Хранят брифы, сценарии, заметки и заглушки медиа.
- **ИИ-ноды.** Малочисленные генераторы информации: персонажи, сцены, планы. Они принимают строго определённые входы и формируют новый артефакт.
- **Ноды-папки.** Контейнер для результатов. Генерации агента отправляются в папку; из неё можно перетащить лучший вариант обратно на карту.
- **HTML-ноды.** Показывают внешние виджеты (погода, 3D из Spline, предпросмотры). Поддерживают выбор ширины и обновление по запросу.

## Поток работы (пример)
1. Бриф фиксируется в текстовой ноде.
2. Промпт и до трёх референс-изображений передаются в агент Midjourney.
3. Агент создаёт кадры и отправляет их в связанную папку.
4. Продюсер открывает папку, просматривает варианты и перетягивает лучший на карту.
5. Изображение и новый текстовый промпт подаются в следующего агента для генерации ракурса.
6. Завершающие материалы (видео, музыка, сайт) также фиксируются как ноды.

## Ключевые требования к UX
- Слева от входящего порта ноды показаь подписи входов: `text`, `image x3`, `speech` и т.п.
- В настройках ИИ-ноды пользователь настраивает входящие порты (тип, название, необязательность, максимальное число файлов).
- У ИИ-ноды есть кнопка доступа к настройкам API/ключей.
- Регулярные генерации создают новые ноды или заполненные заглушки (например, «папка результата»).
- Папку можно открыть: слева — настройки предыдущей ноды, справа — список артефактов с кнопкой «Перегенерировать» для повторной выгрузки из агента.

## Хранилище данных
- `FlowNode.meta.input_ports` — массив спецификаций входов (`id`, `title`, `kind`, `required`, `max_items`).
- Для папок храним ссылки на файлы и историю происхождения (node_id источника).
- Каждая генерация логируется в `runs`, чтобы можно было вернуть историю.

## Следующие шаги
1. Реализовать модель `input_ports` и UI-редактор (см. план разработки ниже).
2. Добавить ноду папки с просмотром/добавлением артефактов и кнопкой повторной генерации.
3. Доделать HTML-ноду: выбор ширины, режим URL/код, кнопка «Обновить».
4. Реализовать автосоздание выходных нод после запуска агента (в т.ч. заполнение папок).
5. Синхронизировать документацию и схемы проекта по мере внедрения.
